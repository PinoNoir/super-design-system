#!/usr/bin/env sh

# Ensure we're in the right directory
cd "$(dirname "$0")/.."

# Add common paths where pnpm might be installed
export PATH="$PWD/node_modules/.bin:/usr/local/bin:/usr/bin:/bin:$HOME/Library/pnpm:$HOME/.nvm/versions/node/*/bin:$PATH"

# Check if pnpm is available, if not try npx
if command -v pnpm >/dev/null 2>&1; then
  PNPM_CMD="pnpm"
elif command -v npx >/dev/null 2>&1; then
  PNPM_CMD="npx pnpm"
else
  echo "Error: Neither pnpm nor npx found in PATH"
  exit 1
fi

# Run lint-staged using the available package manager
echo "Running lint-staged..."
$PNPM_CMD exec lint-staged

# Run linting on all packages
echo "Running lint:fix on packages..."
$PNPM_CMD lint:fix --filter=./packages/*

echo "Pre-commit checks completed successfully!"
